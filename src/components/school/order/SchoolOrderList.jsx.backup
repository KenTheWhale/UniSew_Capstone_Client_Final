    DialogActions,
    Divider
import { getOrdersBySchool, cancelOrder } from '../../../services/OrderService.jsx';
import DisplayImage from '../../ui/DisplayImage.jsx';

// Helper function to transform API data to component format
const transformOrderData = (apiOrders) => {
    return apiOrders.map(order => {
        // Transform order details to items with individual pricing
        const items = order.orderDetails.map(detail => {
            const itemPrice = 150000; // Default price per item (you might want to get this from API)
            return {
                name: `${detail.deliveryItem.designItem.gender === 'boy' ? 'Male' : 'Female'} ${detail.deliveryItem.designItem.type.charAt(0).toUpperCase() + detail.deliveryItem.designItem.type.slice(1)}`,
                quantity: detail.quantity,
                price: itemPrice,
                size: detail.size,
    DialogActions,
    Divider
                fabricName: detail.deliveryItem.designItem.fabricName,
                color: detail.deliveryItem.designItem.color,
                frontImageUrl: detail.deliveryItem.frontImageUrl,
                backImageUrl: detail.deliveryItem.backImageUrl,
                logoPosition: detail.deliveryItem.designItem.logoPosition,
                baseLogoHeight: detail.deliveryItem.baseLogoHeight
            };
        });

        return {
            id: order.id.toString(),
            orderNumber: `ORD-${new Date(order.orderDate).getFullYear()}-${order.id.toString().padStart(3, '0')}`,
            schoolName: order.school?.business || 'N/A', // Extract from school.business
            schoolContactName: order.school?.name || '', // Contact person name
            schoolBusiness: order.school?.business || '',
            schoolAddress: order.school?.address || '',
            schoolPhone: order.school?.phone || '',
            schoolAvatar: order.school?.avatar || '',
            schoolEmail: order.school?.account?.email || '',
            orderDate: order.orderDate,
import { getOrdersBySchool, cancelOrder } from '../../../services/OrderService.jsx';
import DisplayImage from '../../ui/DisplayImage.jsx';

// Helper function to transform API data to component format
const transformOrderData = (apiOrders) => {
    return apiOrders.map(order => {
        // Transform order details to items with individual pricing
        const items = order.orderDetails.map(detail => {
            const itemPrice = 150000; // Default price per item (you might want to get this from API)
            return {
                name: `${detail.deliveryItem.designItem.gender === 'boy' ? 'Male' : 'Female'} ${detail.deliveryItem.designItem.type.charAt(0).toUpperCase() + detail.deliveryItem.designItem.type.slice(1)}`,
                quantity: detail.quantity,
                price: itemPrice,
                size: detail.size,
                category: detail.deliveryItem.designItem.category,
                fabricName: detail.deliveryItem.designItem.fabricName,
                color: detail.deliveryItem.designItem.color,
                frontImageUrl: detail.deliveryItem.frontImageUrl,
                backImageUrl: detail.deliveryItem.backImageUrl,
                logoPosition: detail.deliveryItem.designItem.logoPosition,
                logoImageUrl: detail.deliveryItem.designItem.logoImageUrl,
                baseLogoWidth: detail.deliveryItem.baseLogoWidth,
                baseLogoHeight: detail.deliveryItem.baseLogoHeight
            };
        });

        return {
            id: order.id.toString(),
            orderNumber: `ORD-${new Date(order.orderDate).getFullYear()}-${order.id.toString().padStart(3, '0')}`,
            schoolName: order.school?.business || 'N/A', // Extract from school.business
            schoolContactName: order.school?.name || '', // Contact person name
            schoolBusiness: order.school?.business || '',
            schoolAddress: order.school?.address || '',
            schoolPhone: order.school?.phone || '',
            schoolAvatar: order.school?.avatar || '',
            schoolEmail: order.school?.account?.email || '',
            orderDate: order.orderDate,
            deliveryDate: order.deadline,
            status: order.status,
            items: items,
            paymentStatus: 'paid', // Default for now
            shippingStatus: order.status === 'completed' ? 'delivered' : order.status === 'processing' ? 'shipped' : 'preparing',
            note: order.note,
            serviceFee: order.serviceFee,
            price: order.price
        };
    });
};
                                transition: 'all 0.2s ease',
                                cursor: record.status === 'cancelled' || record.status === 'completed' || cancellingOrderId === record.id ? 'not-allowed' : 'pointer'
                            {cancellingOrderId === record.id ? (
                                <Box sx={{ display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                                    <Box
                                            width: 16,
                                            height: 16,
                                            border: '2px solid #9ca3af',
                                            borderTop: '2px solid #ef4444',
                                            borderRadius: '50%',
                                            animation: 'spin 1s linear infinite',
                                            '@keyframes spin': {
                                                '0%': { transform: 'rotate(0deg)' },
                                                '100%': { transform: 'rotate(360deg)' }
                                            }
                                        }}
                                    />
                                </Box>
                            ) : (
                                <CancelIcon />
                            )}
                    maxWidth="lg"
                        sx: { 
                            borderRadius: 4,
                            boxShadow: '0 20px 60px rgba(0,0,0,0.15)'
                        }
                                         {/* Header Section */}
                         fontWeight: 600,
                         py: 3,
                         px: 4
                     }}>
                         <Box sx={{ display: 'flex', flexDirection: 'column', gap: 2 }}>
                             <Typography variant="h5" sx={{ fontWeight: 700, color: 'white' }}>
                             </Typography>
                             <Box sx={{ display: 'flex', alignItems: 'center', gap: 2, flexWrap: 'wrap' }}>
                                 <Chip
                                     icon={getStatusIcon(selectedOrder.status)}
                                     label={getStatusText(selectedOrder.status)}
                                     sx={{
                                         backgroundColor: 'rgba(255,255,255,0.2)',
                                         color: 'white',
                                         fontWeight: 600,
                                         '& .MuiChip-icon': { color: 'white' }
                                     }}
                                 />
                                 <Typography variant="body1" sx={{ opacity: 0.9 }}>
                                     Order placed on {formatDate(selectedOrder.orderDate)}
                                 </Typography>
                             </Box>
                         </Box>

                    <DialogContent sx={{ p: 0 }}>
                        {/* School Information Card */}
                        <Box sx={{ p: 4, borderBottom: '1px solid #f1f5f9' }}>
                            <Typography variant="h6" sx={{ fontWeight: 600, mb: 3, color: '#1e293b' }}>
                            <Grid container spacing={3}>
                                <Grid item xs={12}>
                                    <Box sx={{ display: 'flex', alignItems: 'flex-start', gap: 3 }}>
                                        {selectedOrder.schoolAvatar && (
                                            <Box
                                                component="img"
                                                src={selectedOrder.schoolAvatar}
                                                alt="School Avatar"
                                                sx={{
                                                    width: 60,
                                                    height: 60,
                                                    borderRadius: 2,
                                                    border: '3px solid #e2e8f0',
                                                    objectFit: 'cover'
                                                }}
                                            />
                                        )}
                                        <Box sx={{ flex: 1 }}>
                                            <Typography variant="h6" sx={{ fontWeight: 600, color: '#1e293b', mb: 1 }}>
                                            <Box sx={{ display: 'flex', flexDirection: 'column', gap: 1 }}>
                                                <Box sx={{ display: 'flex', alignItems: 'center', gap: 2 }}>
                                                    <Box sx={{ 
                                                        width: 8, 
                                                        height: 8, 
                                                        backgroundColor: '#3b82f6', 
                                                        borderRadius: '50%' 
                                                    }} />
                                                    <Typography variant="body2" color="text.secondary">
                                                        Contact: <strong>{selectedOrder.schoolContactName}</strong>
                                                </Box>
                                                <Box sx={{ display: 'flex', alignItems: 'center', gap: 2 }}>
                                                    <Box sx={{ 
                                                        width: 8, 
                                                        height: 8, 
                                                        backgroundColor: '#10b981', 
                                                        borderRadius: '50%' 
                                                    }} />
                                                    <Typography variant="body2" color="text.secondary">
                                                        Email: <strong>{selectedOrder.schoolEmail}</strong>
                                                </Box>
                                                {selectedOrder.schoolPhone && (
                                                    <Box sx={{ display: 'flex', alignItems: 'center', gap: 2 }}>
                                                        <Box sx={{ 
                                                            width: 8, 
                                                            height: 8, 
                                                            backgroundColor: '#f59e0b', 
                                                            borderRadius: '50%' 
                                                        }} />
                                                        <Typography variant="body2" color="text.secondary">
                                                            Phone: <strong>{selectedOrder.schoolPhone}</strong>
                                                    </Box>
                                                )}
                                                {selectedOrder.schoolAddress && (
                                                    <Box sx={{ display: 'flex', alignItems: 'flex-start', gap: 2, mt: 1 }}>
                                                        <Box sx={{ 
                                                            width: 8, 
                                                            height: 8, 
                                                            backgroundColor: '#8b5cf6', 
                                                            borderRadius: '50%',
                                                            mt: 0.5
                                                        }} />
                                                        <Typography variant="body2" color="text.secondary">
                                                            Address: <strong>{selectedOrder.schoolAddress}</strong>
                                                    </Box>
                                                )}
                                            </Box>
                                        </Box>
                                </Grid>
                            </Grid>
                        </Box>
                const response = await getOrdersBySchool();
                
                if (response && response.status === 200) {
                    const transformedOrders = transformOrderData(response.data.body || []);
                    setOrders(transformedOrders);
                    console.log('Orders loaded:', transformedOrders);
                } else {
                                const regularItems = selectedOrder.items.filter(item => item.category === 'regular');
                }
            } catch (error) {
                console.error('Error fetching orders:', error);
                enqueueSnackbar('An error occurred while loading orders', { variant: 'error' });
                                const peItems = selectedOrder.items.filter(item => item.category === 'physical education' || item.category === 'pe');
                                
                                return (
                                    <Box sx={{ display: 'flex', flexDirection: 'column', gap: 3 }}>
                                        {/* Regular Uniforms Section */}
                                        <Box sx={{
                                            border: '2px solid #e2e8f0',
                                            borderRadius: 4,
                                            overflow: 'hidden',
                                            backgroundColor: 'white'
                                        }}>
                                            {/* Regular Header */}
                                            <Box sx={{
                                                background: 'linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)',
                                                color: 'white',
                                                p: 3,
                                                textAlign: 'center'
                                            }}>
                                                <Typography variant="h6" sx={{ fontWeight: 700, mb: 1 }}>
                                                    Regular Uniforms
                                                <Typography variant="body2" sx={{ opacity: 0.9 }}>
                                                    Daily school uniforms
                                            </Box>
    const handleCancelOrder = (orderId) => {
        // Update order status to cancelled
        setOrders(prev => prev.map(order => 
            order.id === orderId 
                ? { ...order, status: 'cancelled' }
                : order
        ));
        enqueueSnackbar('Order cancelled successfully!', { variant: 'success' });
                                                {regularItems.length > 0 ? (
                                                    regularItems.map((item, index) => (
                                                        <Box key={index} sx={{
                                                            border: '1px solid #f1f5f9',
                                                            borderRadius: 3,
                                                            p: 3,
                                                            mb: 2,
                                                            backgroundColor: '#fafbff',
                                                            transition: 'all 0.3s ease',
                                                            '&:hover': {
                                                                borderColor: '#3b82f6',
                                                                backgroundColor: '#f0f4ff',
                                                                transform: 'translateX(4px)'
                                                            },
                                                            '&:last-child': { mb: 0 }
                                                        }}>
                                                            {/* Item Header */}
                                                            <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 2 }}>
                                                                <Typography variant="subtitle1" sx={{ fontWeight: 600, color: '#1e293b' }}>
                                                                    {item.name}
                                                                <Box sx={{
                                                                    backgroundColor: '#3b82f6',
                                                                    color: 'white',
                                                                    px: 2,
                                                                    py: 0.5,
                                                                    borderRadius: 20,
                                                                    fontSize: '0.75rem',
                                                                    fontWeight: 600
                                                                }}>
                                                                    {item.quantity}
                                                                </Box>
                                                            </Box>

                                                            {/* Item Details */}
                                                            <Box sx={{ display: 'flex', gap: 1, flexWrap: 'wrap', mb: 2 }}>
                                                                    label={item.size} 
                                                                    size="small" 
                                                                    sx={{ 
                                                                        backgroundColor: '#dbeafe', 
                                                                        color: '#1e40af',
                                                                        fontWeight: 600
                                                                    }} 
                                                                    label={item.fabricName} 
                                                                    size="small" 
                                                                    sx={{ borderColor: '#cbd5e1' }}
                                                                />
                                                            </Box>

                                                            {/* Color and Logo */}
                                                            <Box sx={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>
                                                                <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                                                                    <Typography variant="body2" color="text.secondary">Color:</Typography>
                                                                    <Box sx={{ 
                                                                        width: 20, 
                                                                        height: 20, 
                                                                        backgroundColor: item.color,
                                                                        borderRadius: 1,
                                                                        border: '2px solid #e2e8f0',
                                                                        boxShadow: '0 2px 4px rgba(0,0,0,0.1)'
                                                                    }} />
                                                                </Box>
                                                                {(item.baseLogoWidth > 0 || item.baseLogoHeight > 0) && (
                                                                    <Typography variant="caption" color="text.secondary">
                                                                        Logo: {item.baseLogoWidth}×{item.baseLogoHeight}cm
                                                                    </Typography>
                                                                )}
                                                            </Box>


                                                                                    gap: 1,
                                                                                    mb: item.logoImageUrl ? 0.5 : 0
                                                                                }}>
                                                                                    <Box component="span" sx={{ 
                                                                                        width: 6, 
                                                                                        height: 6, 
                                                                                        backgroundColor: '#4338ca', 
                                                                                        borderRadius: '50%' 
                                                                                    }} />
                                                                                    Position: {item.logoPosition}
                                                                                </Typography>
                                                                            )}
                                                                            {item.logoImageUrl && (
                                                                                <Typography variant="caption" sx={{ color: '#6366f1', fontWeight: 500 }}>
                                                                                    Custom logo included
                                                                                </Typography>
                                                                            )}
                                                                        </Box>
                                                                    </Box>
                                                                </Box>
                                                            )}
                                                        </Box>
                                                    ))
                    <Tooltip title="Cancel Order">
                                                    <Box sx={{
                            onClick={() => handleCancelOrder(record.id)}
                            disabled={record.status === 'cancelled' || record.status === 'completed'}
                                                        textAlign: 'center',
                                color: record.status === 'cancelled' || record.status === 'completed' ? '#9ca3af' : '#ef4444',
                                                        color: 'text.secondary'
                                    backgroundColor: record.status === 'cancelled' || record.status === 'completed' ? 'transparent' : '#fef2f2',
                                    transform: record.status === 'cancelled' || record.status === 'completed' ? 'none' : 'scale(1.1)'
                                                            No Data
                                transition: 'all 0.2s ease',
                                cursor: record.status === 'cancelled' || record.status === 'completed' ? 'not-allowed' : 'pointer'
                                                        <Typography variant="body2">
                                                            No regular uniforms in this order
                                                        </Typography>
                            <CancelIcon />
                                                textAlign: 'center'
                                            }}>
                                                <Typography variant="h6" sx={{ fontWeight: 700, mb: 1 }}>
                                                    Physical Education
                                                </Typography>
                                                <Typography variant="body2" sx={{ opacity: 0.9 }}>
                                                    Sports & PE uniforms
                                                </Typography>
                                            </Box>

                                            {/* PE Items */}
                                            <Box sx={{ p: 3 }}>
                                                {peItems.length > 0 ? (
                                                    peItems.map((item, index) => (
                                                        <Box key={index} sx={{
                                                            border: '1px solid #f1f5f9',
                                                            borderRadius: 3,
                                                            p: 3,
                                                            mb: 2,
                                                            backgroundColor: '#f0fdf4',
                                                            transition: 'all 0.3s ease',
                                                            '&:hover': {
                                                                borderColor: '#059669',
                                                                backgroundColor: '#dcfce7',
                                                                transform: 'translateX(4px)'
                                                            },
                                                            '&:last-child': { mb: 0 }
                                                        }}>
                                                            {/* Item Header */}
                                                            <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 2 }}>
                                                                <Typography variant="subtitle1" sx={{ fontWeight: 600, color: '#1e293b' }}>
                                                                    {item.name}
                                                                </Typography>
                                                                <Box sx={{
                                                                    backgroundColor: '#059669',
                                                                    color: 'white',
                                                                    px: 2,
                                                                    py: 0.5,
                                                                    borderRadius: 20,
                                                                    fontSize: '0.75rem',
                                                                    fontWeight: 600
                                                                }}>
                                                                    {item.quantity}
                                                                </Box>
                                                            </Box>

                                                            {/* Item Details */}
                                                            <Box sx={{ display: 'flex', gap: 1, flexWrap: 'wrap', mb: 2 }}>
                                                                    label={item.size} 
                                                                    size="small" 
                                                                    sx={{ 
                                                                        backgroundColor: '#d1fae5', 
                                                                        color: '#065f46',
                                                                        fontWeight: 600
                                                                    }} 
                                                                />
                                                                <Chip 
                                                                    label={item.fabricName} 
                                                                    size="small" 
                                                                    sx={{ borderColor: '#a7f3d0' }}

                                                            {/* Color and Logo */}
                                                            <Box sx={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>
                                                                <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                                                                    <Typography variant="body2" color="text.secondary">Color:</Typography>
                                                                    <Box sx={{ 
                                                                        width: 20, 
                                                                        height: 20, 
                                                                        backgroundColor: item.color,
                                                                        borderRadius: 1,
                                                                        border: '2px solid #e2e8f0',
                                                                        boxShadow: '0 2px 4px rgba(0,0,0,0.1)'
                                                                    }} />
                                                                </Box>
                                                                {(item.baseLogoWidth > 0 || item.baseLogoHeight > 0) && (
                                                                    <Typography variant="caption" color="text.secondary">
                                                                        Logo: {item.baseLogoWidth}×{item.baseLogoHeight}cm
                                                                )}
                                                            </Box>

                                                            {/* Logo Information */}
                                                            {(item.logoPosition || item.logoImageUrl) && (
                                                                <Box sx={{
                                                                    backgroundColor: '#ecfdf5',
                                                                    borderRadius: 2,
                                                                    p: 2,
                                                                    mt: 2,
                                                                    border: '1px solid #a7f3d0'
                                                                }}>
                                                                    <Box sx={{ display: 'flex', alignItems: 'center', gap: 2 }}>
                                                                        {item.logoImageUrl && (
                                                                            <DisplayImage
                                                                                imageUrl={item.logoImageUrl}
                                                                                alt="Logo"
                                                                                width={32}
                                                                                height={32}
                                                                            />
                                                                        )}
                                                                        <Box sx={{ flex: 1 }}>
                                                                            {item.logoPosition && (
                                                                                <Typography variant="body2" sx={{ 
                                                                                    color: '#047857', 
                                                                                    fontWeight: 500,
                                                                                    gap: 1,
                                                                                    mb: item.logoImageUrl ? 0.5 : 0
                                                                                }}>
                                                                                    <Box component="span" sx={{ 
                                                                                        width: 6, 
                                                                                        height: 6, 
                                                                                        backgroundColor: '#047857', 
                                                                                        borderRadius: '50%' 
                                                                                    }} />
                                                                                    Position: {item.logoPosition}
                                                                            )}
                                                                            {item.logoImageUrl && (
                                                                                <Typography variant="caption" sx={{ color: '#10b981', fontWeight: 500 }}>
                                                                                    Custom logo included
                                                                            )}
                                                                        </Box>
                                                                    </Box>
                                                                </Box>
                                                            )}
                                                        </Box>
                                                    ))
                                                ) : (
                                                    <Box sx={{
                                                        textAlign: 'center',
                                                        py: 4,
                                                        color: 'text.secondary'
                                                    }}>
                                                        <Typography variant="h6" sx={{ mb: 1, opacity: 0.6 }}>
                                                            No Data
                                                        </Typography>
                                                        <Typography variant="body2">
                                                            No PE uniforms in this order
                                                )}
                                        </Box>
                                    </Box>
                                );
                            })()}

                            {/* Additional Information */}
                            {(selectedOrder.note || selectedOrder.serviceFee > 0) && (
                                <Box sx={{ mt: 4 }}>
                                    <Typography variant="h6" sx={{ fontWeight: 600, mb: 3, color: '#1e293b' }}>
                                        Additional Information
                                    </Typography>
                                    <Grid container spacing={3}>
                                        {selectedOrder.note && (
                                            <Grid item xs={12} md={selectedOrder.serviceFee > 0 ? 8 : 12}>
                                                <Box sx={{
                                                    backgroundColor: '#fffbeb',
                                                    borderRadius: 3,
                                                    p: 3,
                                                    border: '1px solid #fed7aa'
                                                }}>
                                                    <Typography variant="subtitle1" sx={{ fontWeight: 600, color: '#92400e', mb: 1 }}>
                                                        Order Notes
                                                    </Typography>
                                                    <Typography variant="body2" sx={{ color: '#451a03', lineHeight: 1.6 }}>
                                                        {selectedOrder.note}
                                                    </Typography>
                                        )}
                                        
                                        {selectedOrder.serviceFee > 0 && (
                                            <Grid item xs={12} md={selectedOrder.note ? 4 : 12}>
                                                    backgroundColor: '#f0f9ff',
                                                    borderRadius: 3,
                                                    p: 3,
                                                    border: '1px solid #bae6fd',
                                                    textAlign: 'center'
                                                }}>
                                                    <Typography variant="subtitle1" sx={{ fontWeight: 600, color: '#0369a1', mb: 1 }}>
                                                        Service Fee
                                                    <Typography variant="h5" sx={{ fontWeight: 700, color: '#0c4a6e' }}>
                                                        {formatCurrency(selectedOrder.serviceFee)}
                                        )}
                                </Box>
                            )}
                        </Box>

                    {/* Footer Actions */}
                    <Box sx={{ 
                        p: 4, 
                        backgroundColor: '#f8fafc', 
                        borderTop: '1px solid #e2e8f0',
                        display: 'flex',
                        justifyContent: 'space-between',
                        alignItems: 'center'
                    }}>
                        <Typography variant="body2" color="text.secondary">
                            Order ID: {selectedOrder.id}
                        </Typography>
                        <Box sx={{ display: 'flex', gap: 2 }}>
                            <Button 
                                onClick={handleCloseOrderDetail} 
                                variant="outlined"
                                sx={{
                                    borderRadius: 3,
                                    px: 3,
                                    py: 1.5,
                                    borderColor: '#d1d5db',
                                    color: '#6b7280',
                                    '&:hover': {
                                        borderColor: '#9ca3af',
                                        backgroundColor: '#f9fafb'
                                    }
                                }}
                            >
                                    borderRadius: 3,
                                    px: 3,
                                    py: 1.5,
                                    boxShadow: '0 4px 14px rgba(102, 126, 234, 0.4)',
                                        background: 'linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%)',
                                        boxShadow: '0 6px 20px rgba(102, 126, 234, 0.6)',
                                        transform: 'translateY(-2px)'
                                Edit Order
                        </Box>
                    </Box>
                    maxWidth="lg"
                        sx: { 
                            borderRadius: 4,
                            boxShadow: '0 20px 60px rgba(0,0,0,0.15)'
                        }
                                         {/* Header Section */}
                         fontWeight: 600,
                         py: 3,
                         px: 4
                     }}>
                         <Box sx={{ display: 'flex', flexDirection: 'column', gap: 2 }}>
                             <Typography variant="h5" sx={{ fontWeight: 700, color: 'white' }}>
                             </Typography>
                             <Box sx={{ display: 'flex', alignItems: 'center', gap: 2, flexWrap: 'wrap' }}>
                                 <Chip
                                     icon={getStatusIcon(selectedOrder.status)}
                                     label={getStatusText(selectedOrder.status)}
                                     sx={{
                                         backgroundColor: 'rgba(255,255,255,0.2)',
                                         color: 'white',
                                         fontWeight: 600,
                                         '& .MuiChip-icon': { color: 'white' }
                                     }}
                                 />
                                 <Typography variant="body1" sx={{ opacity: 0.9 }}>
                                     Order placed on {formatDate(selectedOrder.orderDate)}
                                 </Typography>
                             </Box>
                         </Box>

                    <DialogContent sx={{ p: 0 }}>
                        {/* School Information Card */}
                        <Box sx={{ p: 4, borderBottom: '1px solid #f1f5f9' }}>
                            <Typography variant="h6" sx={{ fontWeight: 600, mb: 3, color: '#1e293b' }}>
                            <Grid container spacing={3}>
                                <Grid item xs={12}>
                                    <Box sx={{ display: 'flex', alignItems: 'flex-start', gap: 3 }}>
                                        {selectedOrder.schoolAvatar && (
                                            <Box
                                                component="img"
                                                src={selectedOrder.schoolAvatar}
                                                alt="School Avatar"
                                                sx={{
                                                    width: 60,
                                                    height: 60,
                                                    borderRadius: 2,
                                                    border: '3px solid #e2e8f0',
                                                    objectFit: 'cover'
                                                }}
                                            />
                                        )}
                                        <Box sx={{ flex: 1 }}>
                                            <Typography variant="h6" sx={{ fontWeight: 600, color: '#1e293b', mb: 1 }}>
                                            <Box sx={{ display: 'flex', flexDirection: 'column', gap: 1 }}>
                                                <Box sx={{ display: 'flex', alignItems: 'center', gap: 2 }}>
                                                    <Box sx={{ 
                                                        width: 8, 
                                                        height: 8, 
                                                        backgroundColor: '#3b82f6', 
                                                        borderRadius: '50%' 
                                                    }} />
                                                    <Typography variant="body2" color="text.secondary">
                                                        Contact: <strong>{selectedOrder.schoolContactName}</strong>
                                                </Box>
                                                <Box sx={{ display: 'flex', alignItems: 'center', gap: 2 }}>
                                                    <Box sx={{ 
                                                        width: 8, 
                                                        height: 8, 
                                                        backgroundColor: '#10b981', 
                                                        borderRadius: '50%' 
                                                    }} />
                                                    <Typography variant="body2" color="text.secondary">
                                                        Email: <strong>{selectedOrder.schoolEmail}</strong>
                                                </Box>
                                                {selectedOrder.schoolPhone && (
                                                    <Box sx={{ display: 'flex', alignItems: 'center', gap: 2 }}>
                                                        <Box sx={{ 
                                                            width: 8, 
                                                            height: 8, 
                                                            backgroundColor: '#f59e0b', 
                                                            borderRadius: '50%' 
                                                        }} />
                                                        <Typography variant="body2" color="text.secondary">
                                                            Phone: <strong>{selectedOrder.schoolPhone}</strong>
                                                    </Box>
                                                )}
                                                {selectedOrder.schoolAddress && (
                                                    <Box sx={{ display: 'flex', alignItems: 'flex-start', gap: 2, mt: 1 }}>
                                                        <Box sx={{ 
                                                            width: 8, 
                                                            height: 8, 
                                                            backgroundColor: '#8b5cf6', 
                                                            borderRadius: '50%',
                                                            mt: 0.5
                                                        }} />
                                                        <Typography variant="body2" color="text.secondary">
                                                            Address: <strong>{selectedOrder.schoolAddress}</strong>
                                                    </Box>
                                                )}
                                            </Box>
                                        </Box>
                                    </Box>
                                </Grid>
                            </Grid>
                        </Box>

                        {/* Product List by Category */}
                        <Box sx={{ p: 4 }}>
                            {(() => {
                                const regularItems = selectedOrder.items.filter(item => item.category === 'regular');
                                const peItems = selectedOrder.items.filter(item => item.category === 'physical education' || item.category === 'pe');
                                
                                return (
                                    <Box sx={{ display: 'flex', flexDirection: 'column', gap: 3 }}>
                                        {/* Regular Uniforms Section */}
                                        <Box sx={{
                                            border: '2px solid #e2e8f0',
                                            borderRadius: 4,
                                            overflow: 'hidden',
                                            backgroundColor: 'white'
                                        }}>
                                            {/* Regular Header */}
                                            <Box sx={{
                                                background: 'linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)',
                                                color: 'white',
                                                p: 3,
                                                textAlign: 'center'
                                            }}>
                                                <Typography variant="h6" sx={{ fontWeight: 700, mb: 1 }}>
                                                    Regular Uniforms
                                                <Typography variant="body2" sx={{ opacity: 0.9 }}>
                                                    Daily school uniforms
                                            </Box>

                                            {/* Regular Items */}
                                            <Box sx={{ p: 3 }}>
                                                {regularItems.length > 0 ? (
                                                    regularItems.map((item, index) => (
                                                        <Box key={index} sx={{
                                                            border: '1px solid #f1f5f9',
                                                            borderRadius: 3,
                                                            p: 3,
                                                            mb: 2,
                                                            backgroundColor: '#fafbff',
                                                            transition: 'all 0.3s ease',
                                                            '&:hover': {
                                                                borderColor: '#3b82f6',
                                                                backgroundColor: '#f0f4ff',
                                                                transform: 'translateX(4px)'
                                                            },
                                                            '&:last-child': { mb: 0 }
                                                        }}>
                                                            {/* Item Header */}
                                                            <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 2 }}>
                                                                <Typography variant="subtitle1" sx={{ fontWeight: 600, color: '#1e293b' }}>
                                                                    {item.name}
                                                                <Box sx={{
                                                                    backgroundColor: '#3b82f6',
                                                                    color: 'white',
                                                                    px: 2,
                                                                    py: 0.5,
                                                                    borderRadius: 20,
                                                                    fontSize: '0.75rem',
                                                                    fontWeight: 600
                                                                }}>
                                                                    {item.quantity}
                                                                </Box>
                                                            </Box>

                                                            {/* Item Details */}
                                                            <Box sx={{ display: 'flex', gap: 1, flexWrap: 'wrap', mb: 2 }}>
                                                                    label={item.size} 
                                                                    size="small" 
                                                                    sx={{ 
                                                                        backgroundColor: '#dbeafe', 
                                                                        color: '#1e40af',
                                                                        fontWeight: 600
                                                                    }} 
                                                                    label={item.fabricName} 
                                                                    size="small" 
                                                                    sx={{ borderColor: '#cbd5e1' }}
                                                                />
                                                            </Box>

                                                            {/* Color and Logo */}
                                                            <Box sx={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>
                                                                <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                                                                    <Typography variant="body2" color="text.secondary">Color:</Typography>
                                                                    <Box sx={{ 
                                                                        width: 20, 
                                                                        height: 20, 
                                                                        backgroundColor: item.color,
                                                                        borderRadius: 1,
                                                                        border: '2px solid #e2e8f0',
                                                                        boxShadow: '0 2px 4px rgba(0,0,0,0.1)'
                                                                    }} />
                                                                </Box>
                                                                {(item.baseLogoWidth > 0 || item.baseLogoHeight > 0) && (
                                                                    <Typography variant="caption" color="text.secondary">
                                                                        Logo: {item.baseLogoWidth}×{item.baseLogoHeight}cm
                                                                    </Typography>
                                                                )}
                                                            </Box>

                                                            {/* Logo Information */}
                                                            {(item.logoPosition || item.logoImageUrl) && (
                                                                <Box sx={{
                                                                    backgroundColor: '#f0f4ff',
                                                                    borderRadius: 2,
                                                                    p: 2,
                                                                    mt: 2,
                                                                    border: '1px solid #c7d2fe'
                                                                }}>
                                                                    <Box sx={{ display: 'flex', alignItems: 'center', gap: 2 }}>
                                                                        {item.logoImageUrl && (
                                                                            <DisplayImage
                                                                                imageUrl={item.logoImageUrl}
                                                                                alt="Logo"
                                                                                width={32}
                                                                                height={32}
                                                                            />
                                                                        )}
                                                                        <Box sx={{ flex: 1 }}>
                                                                            {item.logoPosition && (
                                                                                <Typography variant="body2" sx={{ 
                                                                                    color: '#4338ca', 
                                                                                    fontWeight: 500,
                                                                                    display: 'flex',
                                                                                    alignItems: 'center',
                                                                                    gap: 1,
                                                                                    mb: item.logoImageUrl ? 0.5 : 0
                                                                                }}>
                                                                                    <Box component="span" sx={{ 
                                                                                        width: 6, 
                                                                                        height: 6, 
                                                                                        backgroundColor: '#4338ca', 
                                                                                        borderRadius: '50%' 
                                                                                    }} />
                                                                                    Position: {item.logoPosition}
                                                                                </Typography>
                                                                            )}
                                                                            {item.logoImageUrl && (
                                                                                <Typography variant="caption" sx={{ color: '#6366f1', fontWeight: 500 }}>
                                                                                    Custom logo included
                                                                                </Typography>
                                                                            )}
                                                                        </Box>
                                                                    </Box>
                                                                </Box>
                                                            )}
                                                        </Box>
                                                    ))
                                                ) : (
                                                    <Box sx={{
                                                        textAlign: 'center',
                                                        py: 4,
                                                        color: 'text.secondary'
                                                    }}>
                                                        <Typography variant="h6" sx={{ mb: 1, opacity: 0.6 }}>
                                                            No Data
                                                        </Typography>
                                                        <Typography variant="body2">
                                                            No regular uniforms in this order
                                                        </Typography>
                                                    </Box>
                                                )}
                                            </Box>
                                        </Box>

                                        {/* Physical Education Section */}
                                        <Box sx={{
                                            border: '2px solid #e2e8f0',
                                            borderRadius: 4,
                                            overflow: 'hidden',
                                            backgroundColor: 'white'
                                        }}>
                                            {/* PE Header */}
                                            <Box sx={{
                                                background: 'linear-gradient(135deg, #059669 0%, #047857 100%)',
                                                color: 'white',
                                                p: 3,
                                                textAlign: 'center'
                                            }}>
                                                <Typography variant="h6" sx={{ fontWeight: 700, mb: 1 }}>
                                                    Physical Education
                                                </Typography>
                                                <Typography variant="body2" sx={{ opacity: 0.9 }}>
                                                    Sports & PE uniforms
                                                </Typography>
                                            </Box>

                                            {/* PE Items */}
                                            <Box sx={{ p: 3 }}>
                                                {peItems.length > 0 ? (
                                                    peItems.map((item, index) => (
                                                        <Box key={index} sx={{
                                                            border: '1px solid #f1f5f9',
                                                            borderRadius: 3,
                                                            p: 3,
                                                            mb: 2,
                                                            backgroundColor: '#f0fdf4',
                                                            transition: 'all 0.3s ease',
                                                            '&:hover': {
                                                                borderColor: '#059669',
                                                                backgroundColor: '#dcfce7',
                                                                transform: 'translateX(4px)'
                                                            },
                                                            '&:last-child': { mb: 0 }
                                                        }}>
                                                            {/* Item Header */}
                                                            <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 2 }}>
                                                                <Typography variant="subtitle1" sx={{ fontWeight: 600, color: '#1e293b' }}>
                                                                    {item.name}
                                                                </Typography>
                                                                <Box sx={{
                                                                    backgroundColor: '#059669',
                                                                    color: 'white',
                                                                    px: 2,
                                                                    py: 0.5,
                                                                    borderRadius: 20,
                                                                    fontSize: '0.75rem',
                                                                    fontWeight: 600
                                                                }}>
                                                                    {item.quantity}
                                                                </Box>
                                                            </Box>

                                                            {/* Item Details */}
                                                            <Box sx={{ display: 'flex', gap: 1, flexWrap: 'wrap', mb: 2 }}>
                                                                    label={item.size} 
                                                                    size="small" 
                                                                    sx={{ 
                                                                        backgroundColor: '#d1fae5', 
                                                                        color: '#065f46',
                                                                        fontWeight: 600
                                                                    }} 
                                                                />
                                                                <Chip 
                                                                    label={item.fabricName} 
                                                                    size="small" 
                                                                    sx={{ borderColor: '#a7f3d0' }}

                                                            {/* Color and Logo */}
                                                            <Box sx={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>
                                                                <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                                                                    <Typography variant="body2" color="text.secondary">Color:</Typography>
                                                                    <Box sx={{ 
                                                                        width: 20, 
                                                                        height: 20, 
                                                                        backgroundColor: item.color,
                                                                        borderRadius: 1,
                                                                        border: '2px solid #e2e8f0',
                                                                        boxShadow: '0 2px 4px rgba(0,0,0,0.1)'
                                                                    }} />
                                                                </Box>
                                                                {(item.baseLogoWidth > 0 || item.baseLogoHeight > 0) && (
                                                                    <Typography variant="caption" color="text.secondary">
                                                                        Logo: {item.baseLogoWidth}×{item.baseLogoHeight}cm
                                                                )}
                                                            </Box>

                                                            {/* Logo Information */}
                                                            {(item.logoPosition || item.logoImageUrl) && (
                                                                <Box sx={{
                                                                    backgroundColor: '#ecfdf5',
                                                                    borderRadius: 2,
                                                                    p: 2,
                                                                    mt: 2,
                                                                    border: '1px solid #a7f3d0'
                                                                }}>
                                                                    <Box sx={{ display: 'flex', alignItems: 'center', gap: 2 }}>
                                                                        {item.logoImageUrl && (
                                                                            <DisplayImage
                                                                                imageUrl={item.logoImageUrl}
                                                                                alt="Logo"
                                                                                width={32}
                                                                                height={32}
                                                                            />
                                                                        )}
                                                                        <Box sx={{ flex: 1 }}>
                                                                            {item.logoPosition && (
                                                                                <Typography variant="body2" sx={{ 
                                                                                    color: '#047857', 
                                                                                    fontWeight: 500,
                                                                                    gap: 1,
                                                                                    mb: item.logoImageUrl ? 0.5 : 0
                                                                                }}>
                                                                                    <Box component="span" sx={{ 
                                                                                        width: 6, 
                                                                                        height: 6, 
                                                                                        backgroundColor: '#047857', 
                                                                                        borderRadius: '50%' 
                                                                                    }} />
                                                                                    Position: {item.logoPosition}
                                                                            )}
                                                                            {item.logoImageUrl && (
                                                                                <Typography variant="caption" sx={{ color: '#10b981', fontWeight: 500 }}>
                                                                                    Custom logo included
                                                                            )}
                                                                        </Box>
                                                                    </Box>
                                                                </Box>
                                                            )}
                                                        </Box>
                                                    ))
                                                ) : (
                                                    <Box sx={{
                                                        textAlign: 'center',
                                                        py: 4,
                                                        color: 'text.secondary'
                                                    }}>
                                                        <Typography variant="h6" sx={{ mb: 1, opacity: 0.6 }}>
                                                            No Data
                                                        </Typography>
                                                        <Typography variant="body2">
                                                            No PE uniforms in this order
                                                )}
                                        </Box>
                                    </Box>
                                );
                            })()}

                            {/* Additional Information */}
                            {(selectedOrder.note || selectedOrder.serviceFee > 0) && (
                                <Box sx={{ mt: 4 }}>
                                    <Typography variant="h6" sx={{ fontWeight: 600, mb: 3, color: '#1e293b' }}>
                                        Additional Information
                                    </Typography>
                                    <Grid container spacing={3}>
                                        {selectedOrder.note && (
                                            <Grid item xs={12} md={selectedOrder.serviceFee > 0 ? 8 : 12}>
                                                <Box sx={{
                                                    backgroundColor: '#fffbeb',
                                                    borderRadius: 3,
                                                    p: 3,
                                                    border: '1px solid #fed7aa'
                                                }}>
                                                    <Typography variant="subtitle1" sx={{ fontWeight: 600, color: '#92400e', mb: 1 }}>
                                                        Order Notes
                                                    </Typography>
                                                    <Typography variant="body2" sx={{ color: '#451a03', lineHeight: 1.6 }}>
                                                        {selectedOrder.note}
                                                    </Typography>
                                        )}
                                        
                                        {selectedOrder.serviceFee > 0 && (
                                            <Grid item xs={12} md={selectedOrder.note ? 4 : 12}>
                                                    backgroundColor: '#f0f9ff',
                                                    borderRadius: 3,
                                                    p: 3,
                                                    border: '1px solid #bae6fd',
                                                    textAlign: 'center'
                                                }}>
                                                    <Typography variant="subtitle1" sx={{ fontWeight: 600, color: '#0369a1', mb: 1 }}>
                                                        Service Fee
                                                    <Typography variant="h5" sx={{ fontWeight: 700, color: '#0c4a6e' }}>
                                                        {formatCurrency(selectedOrder.serviceFee)}
                                        )}
                                </Box>
                            )}
                        </Box>

                    {/* Footer Actions */}
                    <Box sx={{ 
                        p: 4, 
                        backgroundColor: '#f8fafc', 
                        borderTop: '1px solid #e2e8f0',
                        display: 'flex',
                        justifyContent: 'space-between',
                        alignItems: 'center'
                    }}>
                        <Typography variant="body2" color="text.secondary">
                            Order ID: {selectedOrder.id}
                        </Typography>
                        <Box sx={{ display: 'flex', gap: 2 }}>
                            <Button 
                                onClick={handleCloseOrderDetail} 
                                variant="outlined"
                                sx={{
                                    borderRadius: 3,
                                    px: 3,
                                    py: 1.5,
                                    borderColor: '#d1d5db',
                                    color: '#6b7280',
                                    '&:hover': {
                                        borderColor: '#9ca3af',
                                        backgroundColor: '#f9fafb'
                                    }
                                }}
                            >
                                    borderRadius: 3,
                                    px: 3,
                                    py: 1.5,
                                    boxShadow: '0 4px 14px rgba(102, 126, 234, 0.4)',
                                        background: 'linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%)',
                                        boxShadow: '0 6px 20px rgba(102, 126, 234, 0.6)',
                                        transform: 'translateY(-2px)'
                                Edit Order
                        </Box>
                    </Box>